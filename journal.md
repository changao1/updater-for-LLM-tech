# Development Journal

## 2026-02-24 — Reorder email sections + bilingual AI summaries

### Changes

**1. Section order: GitHub now appears before arXiv**

- Modified `src/formatters/issue_formatter.py`: `format_daily_issue()` now emits sections in the order GitHub -> arXiv -> Papers with Code (previously arXiv -> GitHub -> PwC). The summary count line at the top was also reordered to match.
- This affects both the GitHub Issue and emails.

**2. Claude-generated bilingual key-point summaries replace truncated abstracts**

Instead of showing a truncated 300-char abstract/description, each item now gets a 2-3 sentence summary generated by Claude that highlights the core contribution and why it matters. Summaries are produced in both English and Chinese.

**Files modified:**

| File | What changed |
|---|---|
| `src/collectors/arxiv_collector.py` | Added `summary_en`, `summary_cn` fields to `ArxivPaper` dataclass |
| `src/collectors/github_collector.py` | Added `summary_en`, `summary_cn` fields to `GitHubItem` dataclass |
| `src/collectors/pwc_collector.py` | Added `summary_en`, `summary_cn` fields to `PwcPaper` dataclass |
| `src/modules/summarizer.py` | **New file.** `Summarizer` class that batches all filtered items into a single Claude API call, asks for EN+CN summaries, parses the JSON response, and attaches results to item objects in-place. Supports batching (30 items per call) for large sets. Graceful fallback on failure. |
| `src/formatters/issue_formatter.py` | Added `lang` parameter to all section formatters and `format_daily_issue()`. New `_get_summary()` helper selects the right summary field (EN/CN) with fallback to truncated original text. Section order changed to GitHub -> arXiv -> PwC. |
| `src/modules/email_sender/bilingual.py` | `send()` now accepts an optional `content_cn` parameter. When provided, the pre-generated CN content is used directly and translation is skipped. Falls back to the original translate-via-Claude behavior if `content_cn` is not given (backward compat for weekly summary). |
| `src/main.py` | Added Summarize step between Filter and Format. Generates two formatted bodies: EN (for Issue + EN email) and CN (for CN email with Chinese summaries). Passes `content_cn` to `BilingualSender.send()`. |

**Design decisions:**

- Summaries are generated in one batched API call (up to 30 items per batch) for cost efficiency. Input ~6K tokens, output ~6K tokens per batch.
- The CN email has Chinese summaries in the blockquote sections while all structural text (headings, badges, author names, links) stays in English. This avoids mistranslation of technical terms.
- The GitHub Issue uses EN summaries (same as the EN email).
- If summarization fails (API error, no key, etc.), the formatter silently falls back to truncated abstracts — the pipeline is never blocked.
- Weekly summary flow (`weekly.py`) is unaffected — it still uses the full-translation approach via `Translator`.
